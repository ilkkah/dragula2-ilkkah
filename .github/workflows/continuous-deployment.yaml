name: 'ContinuousDeployment'

on:
    workflow_run:
        branches: [master]
        types: [completed]
        workflows: [ContinuousIntegration]

permissions:
    contents: read
    pages: write
    id-token: write

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: 'Checkout'
              uses: actions/checkout@755da8c3cf115ac066823e79a1e1788f8940201b # v3.2.0
            - name: 'Setup node'
              uses: actions/setup-node@8c91899e586c5b171469028077307d293428b516 # v3.5.1
              with:
                  node-version: 17
                  architecture: x64
            - name: 'Setup PNPM'
              uses: pnpm/action-setup@c3b53f6a16e57305370b4ae5a540c2077a1d50dd # v2.2.4
              with:
                  version: 6.10.0
            - name: 'Install project'
              run: pnpm install
            - name: 'Launch build'
              run: pnpm run build
            - name: 'Setup Pages'
              uses: actions/configure-pages@c5a3e1159e0cbdf0845eb8811bd39e39fc3099c2 # v2.1.3
            - name: 'Upload artifact'
              uses: actions/upload-pages-artifact@v1
              with:
                  path: './'

    deploy:
        environment:
            name: github-pages
            url: ${{ steps.deployment.outputs.page_url }}
        runs-on: ubuntu-latest
        needs: build
        steps:
            - name: 'Deploy to GitHub Pages'
              id: deployment
              uses: actions/deploy-pages@20a4baa1095bad40ba7d6ca0d9abbc220b76603f # v1.2.3
